@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div id="chat-area">
    <ul id="messages"></ul>
    <ul id="users">
        <li><b>Users online</b></li>
    </ul>
    <div class="clear">
    </div>
    <form id="sendmessage" action="#">
        <input type="text" id="new-message" />
        <input type="submit" id="send" value="Send" class="send" />
    </form>
</div>

<script src="https://unpkg.com/@@aspnet/signalr-client@1.0.0-alpha2-final/dist/browser/signalr-clientES5-1.0.0-alpha2-final.js" integrity="sha384-d0DyKu5pTAEIv8W1GkHAD2OZyyf/uvydsCOz3S+LUII6s/ZoO0VidAVIau06/nzk" crossorigin="anonymous"></script>
<script>

// TODO: Connect to SignalR!

document.getElementById('sendmessage').addEventListener('submit', event => {
    let data = document.getElementById('new-message').value;
    alert("TODO: Send to SignalR!");
    event.preventDefault();
});

function removeUserOnline(user) {
    appendLine('User ' + user.name + ' left the chat');
    document.getElementById(user.connectionId).outerHTML = '';
}

function appendMessage(userName, message) {
    var nameElement = document.createElement('b');
    nameElement.innerText = userName + ':';

    var msgElement = document.createElement('span');
    msgElement.innerText = ' ' + message;

    var child = document.createElement('li');
    child.appendChild(nameElement);
    child.appendChild(msgElement);
    document.getElementById('messages').appendChild(child);
}

function appendLine(line, color) {
    let child = document.createElement('li');
    if (color) {
        child.style.color = color;
    }
    child.innerText = line;
    document.getElementById('messages').appendChild(child);
};

function addUserOnline(user) {
    appendLine('User ' + user.name + ' joined the chat');
    if (document.getElementById(user.connectionId)) {
        return;
    }
    var userLi = document.createElement('li');
    userLi.innerText = `${user.name} (${user.connectionId})`;
    userLi.id = user.connectionId;
    document.getElementById('users').appendChild(userLi);
}

function getParameterByName(name, url) {
    if (!url) {
        url = window.location.href;
    }
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
};

</script>
